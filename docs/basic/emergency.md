# 应急处理流程和规范
## 线上故障定义
为了让产品研发人员可以更快速恢复问题、解决问题，也为探索更好的保证产品质量的方法，针对线上故障，需要规范的处理流程。<br/><br/>
故障是产品存在的错误、毛病等各种问题，也是系统所需要实现的某种功能的失效或违背。何为线上故障？产品开发完成、测试通过并发布后，用户在使用过程中反馈的所有问题都属于线上故障。<br/>

## 线上故障分类
软件故障有多重分类方法，如按出现的开发阶段划分，按失效产生的后果来划分等。如何对线上故障分类呢？

#### 步骤1	选择故障分类依据
故障有两个重要因素：严重性、优先级。线上故障的优先级在当前所有故障里面是最高的，所以我们对线上故障分类时直接根据其严重性（失效后产生的后果）来分类。

#### 步骤2	定义故障级别
确定故障分类依据后，需要基于选择的分类依据制定故障级别。根据故障的影响程度，将线上故障的级别定义如下：<br/>
（1）致命故障 Critical：系统崩溃，停止运行，阻碍用户工作继续进行。<br/>
（2）严重故障Major：主流程不通，影响系统基本功能。<br/>
（3）一般故障 Minor：功能没有完全实现但不影响使用，功能菜单存在缺陷但不会影响系统稳定性。<br/>
（4）提示类故障Suggestion：建议优化类问题。<br/>

#### 步骤3	制定故障等级列表
基于分类依据和故障级别定义制定对应的故障等级列表，后续有线上故障发生时，相关人员可直接参考该列表评估故障等级。下表是基于严重性定义以及区块链实际应用场景制定的一份故障等级列表，将线上故障分为如下4类：


|故障级别             |描述       |错误内容举例           |
|:---------------:|:-------------|:-----------|
|L1|群组或客户端不能正常工作；<br/>引起用户对产品严重不满意，<br/>造成投诉或放弃使用。|1）	节点启动失败、因程序导致的节点连接异常、共识异常导等导致整个群组不能正常工作；<br/>2）	Console、SDK等客户端无法正常使用；<br/>3）	由程序引起的系统崩溃、死机、程序非法退出；<br/>4）	死循环、数据库发生死锁、与数据库连接错误；<br/>5）	因程序问题造成资金损失等；<br/>6）	安全类问题。|
|L2|严重影响系统基本功能使用              |1）	因代码问题引起的节点同步异常；<br/>2）	因代码问题引起的部分节点异常但群组能正常工作；<br/>3）	程序接口错误；<br/>4）	数据库保存调用错误，数据库表、业务规则、缺省值未加完整性等约束条件。<br/>5）	导致用户信息泄漏、用户数据丢失等问题。<br/>6）	模块无法启动或调用、关联程序调用冲突、内存溢出等稳定性问题、性能问题。|
|L3|影响系统基本功能使用，但有规避途径。<br/>影响次要功能实现或部分场景存在问题。  |1）	节点在某些场景下表现不符合预期；<br/>2）	Console、SDK等客户端在某些场景下表现不符合预期；<br/>3）	Console的命令参数未作相关限制；<br/>4）	次要功能没有完全实现但不影响使用；<br/>5）	脚本错误；<br/>6）	响应时间较长、查询时间较长、边界错误等；<br/>7）	不严重的概率性问题。|
|L4|较小错误，使操作者不方便，<br/>但不影响功能实现。|1）	Console、SDK等错误提示信息等有错别字、语法错误；<br/>2）	Console命令的帮助信息描述不清楚；<br/>3）	Console命令的页面格式排版不整齐、不规范、不美观；<br/>4）	Console命令输入输出不规范；<br/>5）	日志种提示信息优化；<br/>6）	用户体验问题、优化建议等。|


## 故障处理流程
线上故障时有发生，要做到及时响应每一次线上故障，尽快恢复业务，就需要一套规范化、标准化的处理流程来约束团队成员，可以按如下步骤制定故障处理流程。

#### 步骤1	明确故障处理目标
对于线上故障的处理，首先需要团队成员对处理目标达成共识。故障处理的目标是尽快恢复服务到正常运行，在生产环境发生故障时要快速恢复服务，减少故障带来的损失以及故障对客户的影响。

#### 步骤2	制定故障处理原则
线上故障发生时，团队成员应遵循统一的处理原则，才能快速、和谐地解决问题。对于线上故障，可以制定如下处理原则：<br/>
（1）第一时间恢复系统、快速止损，而不是彻底解决问题；<br/>
（2）明显资金损失时，要第一时间升级，快速止损；<br/>
（3）指标要围绕目标，快速启动应急过程与止损方案；<br/>
（4）当前负责人不能短时间内解决问题，则必须进行升级处理；<br/>
（5）处理过程在不影响用户体验的前提下，保留现场。<br/>

#### 步骤3	定义故障处理时效
不同级别的故障影响范围不一样，也就要求处理时限不一样，需要事先对各等级的故障处理时效有明确要求，后续故障发生时各个责任人按照规定的时间要求完成任务。下表是基于故障等级列表定义的处理时限要求：<br/>
|故障级别             |严重程度      |处理时限          |
|:---------------:|:-------------:|:-----------:|
|L1|Critical 致命|立即解决，1小时内修复   |
|L2|Major 严重|24小时内修复       |
|L3|Minor 一般|下个版本解决       |
|L4|Suggestion 提示/建议|尽量在下个版本解决          |

#### 步骤4	明确故障参与人员及责任
下表是根据故障等级制定的故障参与人及责任：




<table>
    <thead>
        <tr>
            <th>故障级别</th>
            <th>参与人员</th>
            <th>责任</th>
        </tr>
    </thead>
    
    <tbody>
        <tr>
            <td rowspan=5>L1/L2</td>
            <td rowspan=1>运维人员</td>
            <td>1）评定故障等级、故障上报<br/>2）同现场用户沟通<br/>3）拉通开发、测试、项目经理讨论问题<br/>4）协助用户故障恢复<br/></td>
        </tr>
        <tr>
            <td rowspan=1>项目经理</td>
            <td>1）协调资源<br/>2）统筹组织、遇到问题时向上升级<br/></td>
        </tr>
        <tr>
            <td rowspan=1>开发人员</td>
            <td>提供故障恢复方法、定位问题、解决问题</td>
        </tr>
        <tr>
            <td rowspan=1>测试人员</td>
            <td>重现问题、回归验证问题</td>
        </tr>
        <tr>
            <td rowspan=1>现场用户</td>
            <td>1）搜集问题定位所需日志<br/>2）故障恢复操作<br/>3）故障解决后验证问题<br/></td>
        </tr>
        <tr>
            <td rowspan=4>L3/L4</td>
            <td rowspan=1>运维人员</td>
            <td>评定故障等级、故障上报</td>
        </tr>
        <tr>
            <td rowspan=1>项目经理</td>
            <td>制定缺陷解决计划</td>
        </tr>
        <tr>
            <td rowspan=1>开发人员</td>
            <td>制定缺陷解决计划、定位问题、解决问题</td>
        </tr>
        <tr>
            <td rowspan=1>测试人员</td>
            <td>回归验证问题</td>
        </tr>
    </tbody>
</table>
